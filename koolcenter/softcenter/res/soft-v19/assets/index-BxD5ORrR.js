import{_ as w,r as u,c as m,b as t,e as v,v as U,x as F,a as g,s as S,o as f,B as O,d as C,y as k,t as A,f as x,F as y,h,u as L,C as E,E as T}from"./index-Drv97ka4.js";const B={props:{close:Function},setup(r){const e=u(""),a=u(null),s=u(!0),n=5,i=p=>{e.value=p,S(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight)})},d=(p=0)=>{g.getUploadLog().then(o=>{let l=o;l.includes("XU6J03M6")?(s.value=!1,l=l.replace(/XU6J03M6/g,""),i(l)):(i(l),setTimeout(()=>d(0),300))}).catch(o=>{p<n?setTimeout(()=>d(p+1),1e3):i(`错误: ${o}

发生此错误是因为前端和后端通讯失联，页面无法获取到插件安装日志文件导致，可能是多种原因造成，请尝试以下：
1. 使用快捷键F5刷新页面，观察软件中心是否加载正常，插件是否安装成功，如果加载正常且安装成功，就不用理会该错误！
2. 如果页面加载不成功，可能是httpd进程崩溃了，尝试进入http://asusrouter.com:3032调试页面后，重启httpd服务
3. 如果上一步的地址无法访问，请使用ssh命令: service restart_httpd重启httpd服务。
4. 如果还是无法解决问题，请依次尝试在调试页面中重启软件中心和重置软件中心！ 
5. 如果以上都无法解决问题，请依次尝试更换浏览器、重启路由器，重置路由器等操作！`)})};return d(),{text:e,textDom:a,disabled:s,Close:()=>{r.close&&r.close()}}}},D={class:"software-log_shade"},M={class:"software-log_shade__pannel"},I={class:"software-log_shade__pannel-content"},V={key:0,class:"software-log_shade__pannel-btn"},z=["disabled"];function N(r,e,a,s,n,i){return f(),m("div",D,[e[4]||(e[4]=t("div",{class:"software-log_shade__bg"},null,-1)),t("div",M,[e[2]||(e[2]=t("div",{class:"software-log_shade__pannel-title"}," 软件中心 - 上传记录 ",-1)),e[3]||(e[3]=t("div",{class:"software-log_shade__pannel-now"},[t("i",null,"    插件安装/卸载过程中请勿刷新此页面！")],-1)),t("div",I,[U(t("textarea",{ref:"textDom",cols:"63",rows:"26",wrap:"on",readonly:"readonly",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false","onUpdate:modelValue":e[0]||(e[0]=d=>s.text=d)},null,512),[[F,s.text]])]),s.disabled?v("",!0):(f(),m("div",V,[t("button",{class:"close",onClick:e[1]||(e[1]=d=>s.Close()),disabled:s.disabled}," 关闭 ",8,z)]))])])}const R=w(B,[["render",N],["__scopeId","data-v-2a8bde4c"]]),X={setup(){const r=L();h(()=>r.getters["model/LocalAppCount"]);const e=h(()=>{var l,c;const o=((c=(l=r==null?void 0:r.state)==null?void 0:l.model)==null?void 0:c.localSoftcenter)||{};return(o==null?void 0:o[E])===T}),a=u(!1),s=()=>{a.value=!1},n=u(null),i=u(!1);return{file:n,uploadFile:o=>{const l=o.target.files;l&&l.length>0&&(n.value=l[0])},sumbitUpload:()=>{var b;if(!e.value)return a.value=!0;if(n.value==null){alert("请选择要上传的文件");return}const o=(b=n==null?void 0:n.value)==null?void 0:b.name;let l=o.split(".");if(l=l[l.length-1],l!="gz")return alert("插件压缩包格式不正确！"),!1;let c=new FormData;c.append(o,n==null?void 0:n.value),g.UploadApp(c).then(H=>{g.InstallUplodaApp(o).then(K=>{i.value=!0})})},logStatus:i,logClose:()=>{i.value=!1,location.reload()},closeFirstOpen:s,eulaAccepted:e,firstOpen:a}},components:{LogComponent:R,FirstOpenComponent:O}},q={class:"software-container"},G={class:"flex"},J={class:"upload-file"},Y={class:"file-info"};function $(r,e,a,s,n,i){var p;const d=x("LogComponent"),_=x("FirstOpenComponent");return f(),m(y,null,[t("div",q,[e[6]||(e[6]=t("div",{class:"software-container_msg"},[t("span",{class:"_header"},"软件中心-插件离线安装"),t("br"),t("span"),t("span",null," · 通过本页，你可以上传插件的离线安装包来安装插件；"),t("br"),t("span",null," · 离线安装会自动解压tar.gz后缀的压缩包，识别压缩包一级目录下的install.sh文件并执行。"),t("br")],-1)),t("form",{onSubmit:e[1]||(e[1]=k((...o)=>s.sumbitUpload&&s.sumbitUpload(...o),["prevent"]))},[t("div",G,[t("label",J,[e[2]||(e[2]=t("span",null,"离线安装插件",-1)),t("input",{type:"file",name:"file",hidden:"",onChange:e[0]||(e[0]=(...o)=>s.uploadFile&&s.uploadFile(...o))},null,32),e[3]||(e[3]=t("div",{class:"button"},"选择文件",-1))]),e[4]||(e[4]=t("div",{class:"auto"},null,-1)),e[5]||(e[5]=t("button",{type:"sumbit",class:"upload-button"}," 上传并安装 ",-1))]),t("div",Y,A(((p=s.file)==null?void 0:p.name)||"未选择任何文件"),1)],32)]),s.logStatus?(f(),C(d,{key:0,close:s.logClose},null,8,["close"])):v("",!0),s.firstOpen?(f(),C(_,{key:1,close:s.closeFirstOpen},null,8,["close"])):v("",!0)],64)}const P=w(X,[["render",$],["__scopeId","data-v-2314814e"]]);export{P as default};
