import{_ as F,r as _,c as g,b as t,e as b,v as S,x as O,a as h,s as k,o as m,B as y,d as C,y as A,t as L,f as U,F as E,h as v,u as T,E as B,G as D}from"./index-C4NngMkr.js";const M={props:{close:Function},setup(r){const e=_(""),a=_(null),s=_(!0),u=5,c=i=>{e.value=i,k(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight)})},o=(i=0)=>{h.getUploadLog().then(d=>{let f=d;f.includes("XU6J03M6")?(s.value=!1,f=f.replace(/XU6J03M6/g,""),c(f)):(c(f),setTimeout(()=>o(0),300))}).catch(d=>{i<u?setTimeout(()=>o(i+1),1e3):c(`错误: ${d}

发生此错误是因为前端和后端通讯失联，页面无法获取到插件安装日志文件导致，可能是多种原因造成，请尝试以下：
1. 使用快捷键F5刷新页面，观察软件中心是否加载正常，插件是否安装成功，如果加载正常且安装成功，就不用理会该错误！
2. 如果页面加载不成功，可能是httpd进程崩溃了，尝试进入http://asusrouter.com:3032调试页面后，重启httpd服务
3. 如果上一步的地址无法访问，请使用ssh命令: service restart_httpd重启httpd服务。
4. 如果还是无法解决问题，请依次尝试在调试页面中重启软件中心和重置软件中心！ 
5. 如果以上都无法解决问题，请依次尝试更换浏览器、重启路由器，重置路由器等操作！`)})};return o(),{text:e,textDom:a,disabled:s,Close:()=>{r.close&&r.close()}}}},I={class:"software-log_shade"},V={class:"software-log_shade__pannel"},z={class:"software-log_shade__pannel-content"},G={key:0,class:"software-log_shade__pannel-btn"},N=["disabled"];function R(r,e,a,s,u,c){return m(),g("div",I,[e[4]||(e[4]=t("div",{class:"software-log_shade__bg"},null,-1)),t("div",V,[e[2]||(e[2]=t("div",{class:"software-log_shade__pannel-title"}," 软件中心 - 上传记录 ",-1)),e[3]||(e[3]=t("div",{class:"software-log_shade__pannel-now"},[t("i",null,"    插件安装/卸载过程中请勿刷新此页面！")],-1)),t("div",z,[S(t("textarea",{ref:"textDom",cols:"63",rows:"26",wrap:"on",readonly:"readonly",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false","onUpdate:modelValue":e[0]||(e[0]=o=>s.text=o)},null,512),[[O,s.text]])]),s.disabled?b("",!0):(m(),g("div",G,[t("button",{class:"close",onClick:e[1]||(e[1]=o=>s.Close()),disabled:s.disabled}," 关闭 ",8,N)]))])])}const X=F(M,[["render",R],["__scopeId","data-v-2a8bde4c"]]),q={setup(){const r=T(),e=v(()=>{var l,n;return((n=(l=r==null?void 0:r.state)==null?void 0:l.model)==null?void 0:n.localSoftcenter)||{}}),a=v(()=>{var l,n;return!!((l=e.value)!=null&&l.softcenter_home_url||(n=e.value)!=null&&n.softcenter_version)}),s=v(()=>{var l;return a.value?((l=e.value)==null?void 0:l[B])===D:!1}),u=_(!1),c=()=>{u.value=!1},o=_(null),p=_(!1);return{file:o,uploadFile:l=>{const n=l.target.files;n&&n.length>0&&(o.value=n[0])},sumbitUpload:()=>{var w;if(!a.value){alert("软件中心数据加载中，请稍候重试！");return}if(!s.value)return u.value=!0;if(o.value==null){alert("请选择要上传的文件");return}const l=(w=o==null?void 0:o.value)==null?void 0:w.name;let n=l.split(".");if(n=n[n.length-1],n!="gz")return alert("插件压缩包格式不正确！"),!1;let x=new FormData;x.append(l,o==null?void 0:o.value),h.UploadApp(x).then(j=>{h.InstallUplodaApp(l).then(P=>{p.value=!0})})},logStatus:p,logClose:()=>{p.value=!1,location.reload()},closeFirstOpen:c,eulaAccepted:s,firstOpen:u}},components:{LogComponent:X,FirstOpenComponent:y}},J={class:"software-container"},Y={class:"flex"},$={class:"upload-file"},H={class:"file-info"};function K(r,e,a,s,u,c){var i;const o=U("LogComponent"),p=U("FirstOpenComponent");return m(),g(E,null,[t("div",J,[e[6]||(e[6]=t("div",{class:"software-container_msg"},[t("span",{class:"_header"},"软件中心-插件离线安装"),t("br"),t("span"),t("span",null," · 通过本页，你可以上传插件的离线安装包来安装插件；"),t("br"),t("span",null," · 离线安装会自动解压tar.gz后缀的压缩包，识别压缩包一级目录下的install.sh文件并执行。"),t("br")],-1)),t("form",{onSubmit:e[1]||(e[1]=A((...d)=>s.sumbitUpload&&s.sumbitUpload(...d),["prevent"]))},[t("div",Y,[t("label",$,[e[2]||(e[2]=t("span",null,"离线安装插件",-1)),t("input",{type:"file",name:"file",hidden:"",onChange:e[0]||(e[0]=(...d)=>s.uploadFile&&s.uploadFile(...d))},null,32),e[3]||(e[3]=t("div",{class:"button"},"选择文件",-1))]),e[4]||(e[4]=t("div",{class:"auto"},null,-1)),e[5]||(e[5]=t("button",{type:"sumbit",class:"upload-button"}," 上传并安装 ",-1))]),t("div",H,L(((i=s.file)==null?void 0:i.name)||"未选择任何文件"),1)],32)]),s.logStatus?(m(),C(o,{key:0,close:s.logClose},null,8,["close"])):b("",!0),s.firstOpen?(m(),C(p,{key:1,close:s.closeFirstOpen},null,8,["close"])):b("",!0)],64)}const W=F(q,[["render",K],["__scopeId","data-v-e86930f1"]]);export{W as default};
